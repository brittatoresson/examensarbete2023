@page "/timer"
@using Examensarbete.Client.Components

<MudGrid>
    <MudItem sx="6" sm="6">
        <MudPaper Class="pa-8">
            <MudText>@TimeLeft</MudText>
            <Timer @bind-Minutes="@min" Disable="startBtn" />

            @if (!startBtn)
            {
                <MudButton @onclick="StartTimer" Color="Color.Primary" Disabled="@(min > 0 ? false: true)">Go!</MudButton>
            }
            else
            {
                <MudButton @onclick="PauseTimer"> @(pause ? "resume" : "pause")</MudButton>
                <MudButton @onclick="StopTimer"> Stop</MudButton>
            }

        </MudPaper>
    </MudItem>
</MudGrid>

@code {
    public int min;
    public TimeSpan TimeLeft;
    public bool pause;
    public bool startBtn;

    public async Task StartTimer()
    {
        startBtn = true;
        TimeLeft = new TimeSpan(0, min, 0);

        while (TimeLeft > new TimeSpan() && pause == false)
        {
            await Task.Delay(1000);
            TimeLeft = TimeLeft.Subtract(new TimeSpan(0, 0, 1));
            StateHasChanged();
        }
    }

    public async Task PauseTimer()
    {
        pause = !pause;
        if (pause == false)
        {
            ContinueTimer();
        }
    }

    public async Task ContinueTimer()
    {
        while (TimeLeft > new TimeSpan() && pause == false)
        {
            await Task.Delay(1000);
            TimeLeft = TimeLeft.Subtract(new TimeSpan(0, 0, 1));
            StateHasChanged();
        }
    }
    public void StopTimer()
    {
        startBtn = false;
        TimeLeft = new TimeSpan(0, 0, 1);
        min = 0;
        StateHasChanged();
    }
}
