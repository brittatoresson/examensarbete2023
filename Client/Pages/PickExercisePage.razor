@page "/exercise"
@using Examensarbete.Shared.Model;
@using Examensarbete.Client.Components;
@inject ExerciseService exerciseService;
@inject Blazored.SessionStorage.ISessionStorageService sessionStorage

<MudPaper Class="pickExercise" Elevation="0">

    <MudGrid>

        @if (exerciseService.ExerciseList.Count < 1)
        {
            <LoadingSpinner></LoadingSpinner>
        }
        else
        {
            @foreach (var item in exerciseService.ExerciseList)
            {
                <MudItem sm="4" sx="12">
                    <MudCard Class="@(item.isActive ? "" :"activeExercise")"
                             @onclick="(() => PickExercise(item))">@item.Name</MudCard>
                        </MudItem>
             }
        }
    </MudGrid>
    @if (pickExercise.Count > 0)
    {

        <MudButton @onclick="SaveExercises">Save</MudButton>
        <NavigationButton Url="focus" />
    }

</MudPaper>

@code {
    List<ExerciseModel> pickExercise = new();

    protected override async Task OnInitializedAsync()
    {
        await exerciseService.GetExercises();
    }

    public async Task PickExercise(ExerciseModel exercise)
    {
        exercise.isActive = true;
        pickExercise.Add(exercise);
    }

    public async Task SaveExercises()
    {
        NyWorkoutModel workout = new();

        var repetitions = RandomRepetitions();
        var randomExercise = RandomExercise();

        workout.Exercise = randomExercise.Name;
        workout.Repetition = repetitions;
        await sessionStorage.SetItemAsync("Workout", workout);
    }

    public ExerciseModel RandomExercise()
    {
        Random random = new();
        var randomInt = random.Next(pickExercise.Count);
        ExerciseModel randomExercise = pickExercise[randomInt];
        return randomExercise;
    }
    public int RandomRepetitions()
    {
        Random random = new();
        var randomRepetitions = random.Next(100);
        return randomRepetitions;
    }
}
